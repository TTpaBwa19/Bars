<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bars Kombat</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            background: #0f0f1a;
            color: white;
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            overflow-x: hidden;
        }

        .money {
            font-size: 32px;
            margin-top: 20px;
        }

        .level-bar {
            width: 80%;
            height: 10px;
            background: #2e2e40;
            border-radius: 5px;
            margin: 10px auto;
            overflow: hidden;
        }

        .level-progress {
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, #32c4ff, #9e6eff);
        }

        .rank {
            font-size: 16px;
            color: #ccc;
        }

        .circle {
            margin: 30px auto;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle at center, #1c1c2e, #10101a);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .bars-img {
            width: 250px;
            height: 250px;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.1s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
            cursor: pointer;
        }

        .floating-coin {
            position: absolute;
            color: gold;
            font-size: 20px;
            animation: floatUp 0.8s ease-out forwards;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { bottom: 20px; opacity: 1; }
            100% { bottom: 100px; opacity: 0; }
        }

        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1c1c2e;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
        }

        .menu-item {
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .menu-item:hover {
            color: #32c4ff;
        }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2c2c3f;
            padding: 20px;
            border-radius: 10px;
            display: none;
            color: white;
            width: 80%;
            max-width: 300px;
            z-index: 1000;
        }

        .modal h2 {
            margin-top: 0;
        }

        .modal button {
            margin-top: 10px;
            padding: 8px 12px;
            background: #27ae60;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            color: #fff;
            background-color: #2e2e40;
        }

        table, th, td {
            border: 1px solid #555;
        }

        th, td {
            padding: 10px;
        }

        th {
            background-color: #444;
        }

        td {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="money">üí∞ <span id="coins">0</span></div>
    <div class="rank">Bronze | –£—Ä–æ–≤–µ–Ω—å 1</div>

    <div class="level-bar">
        <div class="level-progress" id="progress"></div>
    </div>

    <div class="circle" id="circle">
        <img src="https://i.ibb.co/k6V4BhbZ/image.png" class="bars-img" id="bars">
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ -->
    <div class="overlay" id="overlay"></div>

    <div class="modal" id="taskListModal">
        <h2>üìö –ó–∞–¥–∞–Ω–∏—è</h2>
        <div id="taskList"></div>
        <button onclick="closeTaskList()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <!-- –ú–µ–Ω—é -->
    <div class="bottom-menu">
        <div class="menu-item" onclick="openTask()">üìö –ó–∞–¥–∞–Ω–∏—è</div>
        <div class="menu-item" onclick="showLeaderboard()">üèÜ –†–µ–π—Ç–∏–Ω–≥</div>
    </div>

    <div id="leaderboard-container"></div>

    <script>
        let coins = 0;
        const maxEnergy = 1000;
        const currentEnergy = 145;
        const progressEl = document.getElementById("progress");
        const circle = document.getElementById("circle");

        progressEl.style.width = ${(currentEnergy / maxEnergy) * 100}%;

        document.getElementById("bars").addEventListener("click", () => {
            coins++;
            document.getElementById("coins").textContent = coins;

            showFloatingCoin("+1");

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
            if (window.Telegram) {
                Telegram.WebApp.sendData(JSON.stringify({
                    action: "click",
                    coins: coins
                }));
            }
        });

        function showFloatingCoin(text) {
            const el = document.createElement("div");
            el.className = "floating-coin";
            el.textContent = text;
            circle.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- –ó–∞–¥–∞–Ω–∏—è ---
        const tasks = [
            { q: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?", a: "4", reward: 20 },
            { q: "5 √ó 3 = ?", a: "15", reward: 25 },
            { q: "–°—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?", a: "–ú–æ—Å–∫–≤–∞", reward: 30 },
        ];

        function openTask() {
            const container = document.getElementById("taskList");
            container.innerHTML = "";

            tasks.forEach((task, index) => {
                const div = document.createElement("div");
                div.style.marginBottom = "10px";

                div.innerHTML = 
                    `<div><b>${task.q}</b> ‚Äî üí∞ ${task.reward}</div>
                    <input type="text" id="answer-${index}" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
                    <button onclick="checkTaskAnswer(${index})">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                `;

                container.appendChild(div);
            });

            document.getElementById("taskListModal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        function checkTaskAnswer(index) {
            const input = document.getElementById(`answer-${index}`);
            const answer = input.value.trim();
            const task = tasks[index];

            if (answer.toLowerCase() === task.a.toLowerCase()) {
                coins += task.reward;
                document.getElementById("coins").textContent = coins;
                alert(`‚úÖ –í–µ—Ä–Ω–æ! +${task.reward} –º–æ–Ω–µ—Ç`);
            } else {
                alert("‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!");
            }
        }

        function closeTaskList() {
            document.getElementById("taskListModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function fetchLeaderboard() {
            try {
                // –ó–∞–ø—Ä–æ—Å –∫ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                const response = await fetch("http://127.0.0.1:5000/leaderboard");
                const leaderboardData = await response.json();

                if (leaderboardData.length === 0) {
                    document.getElementById('leaderboard-container').innerHTML = "<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∏–≥—Ä–æ–∫–∞—Ö</p>";
                    return;
                }

                // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏
                let tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>–†–∞–Ω–≥</th>
                                <th>ID –ò–≥—Ä–æ–∫–∞</th>
                                <th>–ú–æ–Ω–µ—Ç—ã</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                leaderboardData.forEach((player, index) => {
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${player.user_id}</td>
                            <td>${player.coins}</td>
                        </tr>
                    `;
                });

                tableHTML += "</tbody></table>";

                // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                document.getElementById('leaderboard-container').innerHTML = tableHTML;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:", error);
                document.getElementById('leaderboard-container').innerHTML = "<p>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>";
            }
        }

        function showLeaderboard() {
            fetchLeaderboard();
        }
    </script>

</body>
</html>

