<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BarsIQ Game</title>
    <style>
        body { background: #111; color: #fff; font-family: sans-serif; text-align: center; margin: 0; }
        .money { font-size: 30px; margin-top: 20px; }
        .bars-img { width: 150px; cursor: pointer; margin-top: 20px; }
        .bottom-menu { position: fixed; bottom: 0; left: 0; width: 100%; background: #222; display: flex; justify-content: space-around; padding: 10px 0; }
        .menu-item { color: white; font-size: 16px; cursor: pointer; }
        .menu-item:hover { color: #32c4ff; }
        .modal, .overlay { display: none; position: fixed; z-index: 999; }
        .modal { top: 50%; left: 50%; transform: translate(-50%, -50%); background: #333; padding: 20px; border-radius: 10px; width: 300px; }
        .overlay { top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal h2 { margin-top: 0; }
        .leaderboard-entry { margin: 5px 0; text-align: left; }
    </style>
</head>
<body>

    <div class="money">üí∞ <span id="coins">0</span></div>

    <img src="https://i.ibb.co/k6V4BhbZ/image.png" class="bars-img" id="bars">

    <div class="bottom-menu">
        <div class="menu-item" onclick="showLeaderboard()">üèÜ –†–µ–π—Ç–∏–Ω–≥</div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="modal" id="leaderboardModal">
        <h2>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</h2>
        <div id="leaderboardList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button onclick="closeLeaderboard()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        let coins = 0;
        const coinEl = document.getElementById("coins");

        document.getElementById("bars").addEventListener("click", () => {
            coins++;
            coinEl.textContent = coins;

            if (window.Telegram?.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify({
                    action: "click",
                    coins: coins
                }));
            }
        });

        function showLeaderboard() {
            document.getElementById("overlay").style.display = "block";
            document.getElementById("leaderboardModal").style.display = "block";
            document.getElementById("leaderboardList").innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";

            if (window.Telegram?.WebApp) {
                Telegram.WebApp.sendData(JSON.stringify({ action: "get_leaderboard" }));
                Telegram.WebApp.onEvent("message", function(event) {
                    if (typeof event.data === "string") {
                        try {
                            const data = JSON.parse(event.data);
                            if (data.leaderboard) {
                                renderLeaderboard(data.leaderboard);
                            }
                        } catch (e) {
                            console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:", e);
                        }
                    }
                });
            }
        }

        function renderLeaderboard(list) {
            const container = document.getElementById("leaderboardList");
            container.innerHTML = "";
            list.forEach((item, i) => {
                const div = document.createElement("div");
                div.className = "leaderboard-entry";
                div.textContent = `${i + 1}. ID ${item.user_id} ‚Äî ${item.coins} üí∞`;
                container.appendChild(div);
            });
        }

        function closeLeaderboard() {
            document.getElementById("overlay").style.display = "none";
            document.getElementById("leaderboardModal").style.display = "none";
        }

        Telegram.WebApp.expand(); // —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–∫–Ω–∞ –≤–Ω—É—Ç—Ä–∏ Telegram
    </script>

</body>
</html>
