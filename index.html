<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bars Kombat</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            margin: 0;
            background: #0f0f1a;
            color: white;
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            overflow-x: hidden;
        }

        .money {
            font-size: 32px;
            margin-top: 20px;
        }

        .level-bar {
            width: 80%;
            height: 10px;
            background: #2e2e40;
            border-radius: 5px;
            margin: 10px auto;
            overflow: hidden;
        }

        .level-progress {
            width: 30%;
            height: 100%;
            background: linear-gradient(90deg, #32c4ff, #9e6eff);
        }

        .rank {
            font-size: 16px;
            color: #ccc;
        }

        .username {
            font-size: 18px;
            margin-top: 10px;
            color: #32c4ff;
        }

        .circle {
            margin: 30px auto;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle at center, #1c1c2e, #10101a);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .bars-img {
            width: 250px;
            height: 250px;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.1s ease;
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
            cursor: pointer;
        }

        .floating-coin {
            position: absolute;
            color: gold;
            font-size: 20px;
            animation: floatUp 0.8s ease-out forwards;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { bottom: 20px; opacity: 1; }
            100% { bottom: 100px; opacity: 0; }
        }

        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1c1c2e;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
        }

        .menu-item {
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .menu-item:hover {
            color: #32c4ff;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2c2c3f;
            padding: 20px;
            border-radius: 10px;
            display: none;
            color: white;
            width: 90%;
            max-width: 500px;
            z-index: 1000;
            overflow-y: auto;
            max-height: 80%;
        }

        .modal h2 {
            margin-top: 0;
            text-align: center;
        }

        .modal button {
            margin-top: 10px;
            padding: 8px 12px;
            background: #27ae60;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            width: 100%;
        }

        .leaderboard {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            color: white;
        }

        .leaderboard th, .leaderboard td {
            border: 1px solid #444;
            padding: 12px;
            text-align: center;
        }

        .leaderboard thead {
            background-color: #2a2a3a;
        }

        .leaderboard tbody tr:nth-child(even) {
            background-color: #252535;
        }

        .leaderboard tbody tr:hover {
            background-color: #1e2b3e;
        }

        .leaderboard td:first-child {
            font-weight: bold;
            font-size: 1.2em;
        }

        .task {
            background: #252535;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .task p {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .task input {
            padding: 10px;
            font-size: 16px;
            width: 70%;
            border: 1px solid #444;
            border-radius: 10px;
            margin-right: 10px;
            background: #1c1c2e;
            color: white;
        }

        .task button {
            padding: 10px 15px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .task button:hover {
            background: #45a049;
        }

        .task-status {
            display: inline-block;
            margin-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }

        .task-completed {
            color: #2ecc71;
        }

        .task-failed {
            color: #e74c3c;
        }

        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div class="money">üí∞ <span id="coins">0</span></div>
    <div class="username" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div class="rank">Bronze | –£—Ä–æ–≤–µ–Ω—å 1</div>

    <div class="level-bar">
        <div class="level-progress" id="progress"></div>
    </div>

    <div class="circle" id="circle">
        <img src="https://i.ibb.co/k6V4BhbZ/image.png" class="bars-img" id="bars">
    </div>

    <div class="overlay" id="overlay"></div>

    <div class="modal" id="leaderboardModal">
        <h2>üèÜ –†–µ–π—Ç–∏–Ω–≥</h2>
        <table class="leaderboard">
            <thead>
                <tr>
                    <th>–ú–µ—Å—Ç–æ</th>
                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                    <th>–ú–æ–Ω–µ—Ç—ã</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
            </tbody>
        </table>
        <button onclick="closeLeaderboard()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="modal" id="taskListModal">
        <h2>üìö –ó–∞–¥–∞–Ω–∏—è</h2>
        <div id="tasks-container"></div>
        <button onclick="closeTaskList()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="bottom-menu">
        <div class="menu-item" onclick="openTask()">üìö –ó–∞–¥–∞–Ω–∏—è</div>
        <div class="menu-item" onclick="toggleLeaderboard()">üèÜ –†–µ–π—Ç–∏–Ω–≥</div>
    </div>

    <script>
        let coins = 0;
        let username = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
        let user_id = null;

        const maxEnergy = 1000;
        const currentEnergy = 145;
        const progressEl = document.getElementById("progress");
        const circle = document.getElementById("circle");

        progressEl.style.width = `${(currentEnergy / maxEnergy) * 100}%`;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        window.addEventListener('load', function() {
            if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
                const tgUser = Telegram.WebApp.initDataUnsafe.user;
                if (tgUser) {
                    user_id = tgUser.id;
                    username = tgUser.username || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${tgUser.id}`;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∏–∫–Ω–µ–π–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    fetch('http://localhost:5000/update_username', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            user_id: user_id,
                            username: username
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log("–ù–∏–∫–Ω–µ–π–º –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ");
                        } else {
                            console.log("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∏–∫–Ω–µ–π–º–∞");
                        }
                    })
                    .catch(error => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error));

                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    loadUserData();
                }
            } else {
                // –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–µ—Å–ª–∏ –Ω–µ –≤ Telegram WebApp)
                user_id = 123456;
                username = "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
                document.getElementById("username").textContent = username;
                loadUserData();
            }
        });

        function loadUserData() {
            fetch(`http://localhost:5000/get_coins?user_id=${user_id}`)
                .then(res => res.json())
                .then(data => {
                    coins = data.coins || 0;
                    document.getElementById("coins").textContent = coins;

                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º username —Å —Å–µ—Ä–≤–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                    if (data.username) {
                        username = data.username;
                    }
                    document.getElementById("username").textContent = username;
                    
                    console.log("–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã:", { coins, username });
                })
                .catch(err => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err));
        }

        document.getElementById("bars").addEventListener("click", () => {
            coins++;
            document.getElementById("coins").textContent = coins;
            showFloatingCoin("+1");
            saveUserData();
        });

        function saveUserData() {
            fetch("http://localhost:5000/update_coins", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    user_id: user_id,
                    coins: coins,
                    username: username
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    console.log("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");
                } else {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", data.error);
                }
            })
            .catch(err => {
                console.error("–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:", err);
            });
        }

        function showFloatingCoin(text) {
            const el = document.createElement("div");
            el.className = "floating-coin";
            el.textContent = text;
            circle.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // –°–∏—Å—Ç–µ–º–∞ –∑–∞–¥–∞–Ω–∏–π –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏
        const allTasks = [
            // –î–µ–Ω—å 1 (–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
            [
                { id: 1, q: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?", a: "4", reward: 20 },
                { id: 2, q: "5 √ó 3 = ?", a: "15", reward: 25 },
                { id: 3, q: "–°—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?", a: "–ú–æ—Å–∫–≤–∞", reward: 30 }
            ],
            // –î–µ–Ω—å 2 (–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
            [
                { id: 4, q: "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 10 / 2?", a: "5", reward: 20 },
                { id: 5, q: "–ì–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –ú–æ—Å–∫–≤—ã?", a: "1147", reward: 30 },
                { id: 6, q: "–ß—Ç–æ —Ç–∞–∫–æ–µ Python?", a: "–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è", reward: 25 }
            ],
            // –î–µ–Ω—å 3 (–í—Ç–æ—Ä–Ω–∏–∫)
            [
                { id: 7, q: "–ö–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è?", a: "–Æ–ø–∏—Ç–µ—Ä", reward: 30 },
                { id: 8, q: "–ö–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü—ã –ú–µ–Ω–¥–µ–ª–µ–µ–≤–∞ –∏–º–µ–µ—Ç —Å–∏–º–≤–æ–ª H?", a: "–í–æ–¥–æ—Ä–æ–¥", reward: 20 },
                { id: 9, q: "–ö–∞–∫–∞—è —Å—Ç—Ä–∞–Ω–∞ –∏–º–µ–µ—Ç —Å–∞–º—É—é –±–æ–ª—å—à—É—é –ø–ª–æ—â–∞–¥—å?", a: "–†–æ—Å—Å–∏—è", reward: 25 }
            ],
            // –î–µ–Ω—å 4 (–°—Ä–µ–¥–∞)
            [
                { id: 10, q: "–°–∫–æ–ª—å–∫–æ –æ–∫–µ–∞–Ω–æ–≤ –Ω–∞ –ó–µ–º–ª–µ?", a: "5", reward: 20 },
                { id: 11, q: "–ö–∞–∫–∞—è —Å—Ç—Ä–∞–Ω–∞ –≤ –Æ–∂–Ω–æ–π –ê–º–µ—Ä–∏–∫–µ?", a: "–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞", reward: 25 },
                { id: 12, q: "–°–∫–æ–ª—å–∫–æ –∑—É–±–æ–≤ —É –≤–∑—Ä–æ—Å–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?", a: "32", reward: 30 }
            ],
            // –î–µ–Ω—å 5 (–ß–µ—Ç–≤–µ—Ä–≥)
            [
                { id: 13, q: "–°–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –≤ –º–∏–Ω—É—Ç–µ?", a: "60", reward: 20 },
                { id: 14, q: "–ß—Ç–æ —Ç–∞–∫–æ–µ HTML?", a: "–Ø–∑—ã–∫ —Ä–∞–∑–º–µ—Ç–∫–∏", reward: 25 },
                { id: 15, q: "–°–∞–º—ã–π –≥–ª—É–±–æ–∫–∏–π –æ–∫–µ–∞–Ω?", a: "–¢–∏—Ö–∏–π", reward: 30 }
            ],
            // –î–µ–Ω—å 6 (–ü—è—Ç–Ω–∏—Ü–∞)
            [
                { id: 16, q: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º?", a: "–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤", reward: 25 },
                { id: 17, q: "–ö–∞–∫–æ–π —è–∑—ã–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏?", a: "JavaScript", reward: 30 },
                { id: 18, q: "–ö–∞–∫–æ–π —Ü–≤–µ—Ç —É –º–∞—Ä—Å–∞?", a: "–ö—Ä–∞—Å–Ω—ã–π", reward: 20 }
            ],
            // –î–µ–Ω—å 7 (–°—É–±–±–æ—Ç–∞)
            [
                { id: 19, q: "–°–∫–æ–ª—å–∫–æ –ª–µ—Ç –¥–ª–∏–ª—Å—è –í–µ–∫ –ü—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è?", a: "100 –ª–µ—Ç", reward: 25 },
                { id: 20, q: "–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–í–æ–π–Ω—É –∏ –º–∏—Ä'?", a: "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π", reward: 30 },
                { id: 21, q: "–ö–∞–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏?", a: "–õ–æ–Ω–¥–æ–Ω", reward: 20 }
            ]
        ];

        const taskAttempts = JSON.parse(localStorage.getItem('taskAttempts')) || {};
        const taskCompleted = JSON.parse(localStorage.getItem('taskCompleted')) || {};
        const lastUpdate = localStorage.getItem('lastUpdate');

        function getDayTasks() {
            const today = new Date();
            const currentDay = today.getDay(); // 0 (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ) –¥–æ 6 (—Å—É–±–±–æ—Ç–∞)
            
            // –ï—Å–ª–∏ –¥–µ–Ω—å –∏–∑–º–µ–Ω–∏–ª—Å—è, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            if (lastUpdate && new Date(lastUpdate).getDate() !== today.getDate()) {
                localStorage.setItem('lastUpdate', today.toISOString());
                return allTasks[currentDay];
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            if (!lastUpdate) {
                localStorage.setItem('lastUpdate', today.toISOString());
            }
            
            return allTasks[currentDay];
        }

        function openTask() {
            renderTasks();
            document.getElementById("taskListModal").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        function renderTasks() {
            const container = document.getElementById("tasks-container");
            container.innerHTML = "";

            const tasks = getDayTasks();

            tasks.forEach(task => {
                const taskBlock = document.createElement("div");
                taskBlock.className = "task";
                taskBlock.id = `task-${task.id}`;

                // –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–¥–∞–Ω–∏—è
                taskBlock.innerHTML = `
                    <p>${task.q}</p>
                    <div class="task-reward">–ù–∞–≥—Ä–∞–¥–∞: ${task.reward} –º–æ–Ω–µ—Ç</div>
                    <div class="task-status" id="status-${task.id}"></div>
                    <div class="error-message" id="error-${task.id}">–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç!</div>
                `;

                // –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞–Ω–∏—è
                const statusEl = taskBlock.querySelector(`#status-${task.id}`);
                const errorEl = taskBlock.querySelector(`#error-${task.id}`);

                if (taskCompleted[task.id]) {
                    // –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                    statusEl.textContent = "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ";
                    statusEl.className = "task-status task-completed";
                } else if (taskAttempts[task.id] >= 3) {
                    // –ü–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã
                    statusEl.textContent = "‚ùå –í—ã –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏";
                    statusEl.className = "task-status task-failed";
                } else {
                    // –ó–∞–¥–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    const inputGroup = document.createElement("div");
                    inputGroup.className = "task-input-group";
                    inputGroup.innerHTML = `
                        <input type="text" class="task-input" id="answer-${task.id}" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç">
                        <button class="task-button" id="submit-${task.id}">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                        <div class="attempts-counter" id="attempts-${task.id}">
                            –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${3 - (taskAttempts[task.id] || 0)}
                        </div>
                    `;
                    taskBlock.appendChild(inputGroup);

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
                    const submitBtn = document.getElementById(`submit-${task.id}`);
                    const answerInput = document.getElementById(`answer-${task.id}`);
                    const attemptsCounter = document.getElementById(`attempts-${task.id}`);

                    submitBtn.addEventListener("click", () => {
                        const userAnswer = answerInput.value.trim();
                        if (!userAnswer) return;

                        if (userAnswer.toLowerCase() === task.a.toLowerCase()) {
                            // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                            taskCompleted[task.id] = true;
                            statusEl.textContent = "‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ";
                            statusEl.className = "task-status task-completed";
                            
                            // –ù–∞—á–∏—Å–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
                            coins += task.reward;
                            document.getElementById("coins").textContent = coins;
                            saveUserData();
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                            showFloatingCoin(`+${task.reward}`);
                            
                            // –£–¥–∞–ª—è–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
                            inputGroup.remove();
                        } else {
                            // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                            taskAttempts[task.id] = (taskAttempts[task.id] || 0) + 1;
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                            errorEl.style.display = "block";
                            setTimeout(() => {
                                errorEl.style.display = "none";
                            }, 2000);
                            
                            if (taskAttempts[task.id] >= 3) {
                                // –ü–æ–ø—ã—Ç–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å
                                statusEl.textContent = "‚ùå –í—ã –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏";
                                statusEl.className = "task-status task-failed";
                                inputGroup.remove();
                            } else {
                                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫
                                attemptsCounter.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${3 - taskAttempts[task.id]}`;
                                answerInput.value = "";
                                answerInput.focus();
                            }
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π
                        localStorage.setItem('taskAttempts', JSON.stringify(taskAttempts));
                        localStorage.setItem('taskCompleted', JSON.stringify(taskCompleted));
                    });
                }

                container.appendChild(taskBlock);
            });
        }

        function toggleLeaderboard() {
            const modal = document.getElementById("leaderboardModal");
            const overlay = document.getElementById("overlay");

            if (modal.style.display === "block") {
                modal.style.display = "none";
                overlay.style.display = "none";
            } else {
                fetch("http://127.0.0.1:5000/leaderboard")
                    .then(response => response.json())
                    .then(data => {
                        const tbody = document.getElementById('leaderboard-body');
                        tbody.innerHTML = '';
                        
                        data.forEach((user, index) => {
                            const tr = document.createElement('tr');
                            const medal = getMedal(index + 1);
                            const displayName = user.username || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.user_id}`;
                            tr.innerHTML = `
                                <td>${medal}</td>
                                <td>${displayName}</td>
                                <td>${user.coins}</td>
                            `;
                            tbody.appendChild(tr);
                        });

                        modal.style.display = "block";
                        overlay.style.display = "block";
                    })
                    .catch(error => {
                        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:", error);
                        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥");
                    });
            }
        }

        function getMedal(position) {
            switch (position) {
                case 1: return 'ü•á';
                case 2: return 'ü•à';
                case 3: return 'ü•â';
                default: return position;
            }
        }

        function closeLeaderboard() {
            document.getElementById("leaderboardModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }

        function closeTaskList() {
            document.getElementById("taskListModal").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
    </script>
</body>
</html>
